(function(root){var typogr=function(obj){return new Wrapper(obj)};typogr.version='0.6.8';if(typeof module!=='undefined'&&module.exports){module.exports=typogr}else if(typeof define==='function'&&define.amd){define(function(){return typogr})}else{root.typogr=typogr}var re=function(regexp,flag){return new RegExp(regexp,flag)};var re_skip_tags=/<(\/)?(style|pre|code|kbd|script|math|title)[^>]*>/i;var amp=typogr.amp=function(text){var re_amp=/(\s|&nbsp;)(&|&amp;|&\#38;)(\s|&nbsp;)/g,re_intra_tag=/(<[^<]*>)?([^<]*)(<\/[^<]*>)?/g;if(!text&&typeof text!=="string"){return}return text.replace(re_intra_tag,function(str,prefix,text,suffix){prefix=prefix||'';suffix=suffix||'';if(prefix.match(re_skip_tags))return prefix+text+suffix;text=text.replace(re_amp,'$1<span class="amp">&amp;</span>$3');return prefix+text+suffix})};var ord=typogr.ord=function(text){if(!text&&typeof text!=="string"){return}var tokens=tokenize(text),result=[],in_skipped_tag=!1,close_match,re_suffix=/(\d+)(st|nd|rd|th)/g;tokens.forEach(function(token){if(token.type==='tag'){result.push(token.txt);close_match=re_skip_tags.exec(token.txt);if(close_match&&close_match[1]===undefined){in_skipped_tag=!0}else{in_skipped_tag=!1}}else{if(in_skipped_tag){result.push(token.txt)}else{result.push(token.txt.replace(re_suffix,'$1<span class="ord">$2</span>'))}}});return result.join('')};var initQuotes=typogr.initQuotes=function(text){var re_quote=re('(?:(?:<(?:p|h[1-6]|li|dt|dd)[^>]*>|^)'+'\\s*'+'(?:<(?:a|em|span|strong|i|b)[^>]*>\\s*)*)'+'(?:("|&ldquo;|&#8220;)|'+'(\'|&lsquo;|&#8216;))','i');if(!text&&typeof text!=="string"){return}return text.replace(re_quote,function(matched_str,dquo,squo){var classname=dquo?"dquo":"quo",quote=dquo?dquo:squo;return[matched_str.slice(0,matched_str.lastIndexOf(quote)),'<span class="',classname,'">',quote,'</span>'].join('')})};var widont=typogr.widont=function(text){var inline_tags='a|em|span|strong|i|b'var word='(?:<(?:'+inline_tags+')[^>]*?>)*?[^\\s<>]+(?:</(?:'+inline_tags+')[^>]*?>)*?'var re_widont=re('('+'\\s+'+word+'\\s+'+word+')'+'(?:\\s+)'+'('+'[^<>\\s]+'+'(?:\\s*</(?:a|em|span|strong|i|b)[^>]*?>\\s*\\.*)*?'+'(?:\\s*?</(?:p|h[1-6]|li|dt|dd)>|$)'+')','gi');return text.replace(re_widont,'$1<span class="widont">&nbsp;</span>$2')};var caps=typogr.caps=function(text){var tokens=tokenize(text),result=[],in_skipped_tag=!1,close_match,re_cap=re('('+'(\\b[A-Z\\d]*'+'[A-Z]\\d*[A-Z]'+'[A-Z\\d\']*\\b)'+'|(\\b[A-Z]+\\.\\s?'+'(?:[A-Z]+\\.\\s?)+)'+'(?:\\s|\\b|$)'+')','g');tokens.forEach(function(token){if(token.type==='tag'){result.push(token.txt);close_match=re_skip_tags.exec(token.txt);if(close_match&&close_match[1]===undefined){in_skipped_tag=!0}else{in_skipped_tag=!1}}else{if(in_skipped_tag){result.push(token.txt)}else{result.push(token.txt.replace(re_cap,function(matched_str,g1,g2,g3){var caps,tail;if(g2){return'<span class="caps">%s</span>'.replace('%s',g2)}else{if(g3.slice(-1)===' '){caps=g3.slice(0,-1);tail=' '}else{caps=g3;tail=''}return'<span class="caps">%s1</span>%s2'.replace('%s1',caps).replace('%s2',tail)}}))}}});return result.join('')};typogr.typogrify=function(src){var text=src;if(src.jquery&&src.html){text=src.html()}text=amp(text);text=widont(text);text=smartypants(text);text=caps(text);text=initQuotes(text);text=ord(text);return text};var smartypants=typogr.smartypants=function(text){var tokens=tokenize(text),result=[],skipped_tag_stack=[],skipped_tag='',skip_match='',in_pre=!1,prev_token_last_char='',last_char,t;tokens.forEach(function(token){if(token.type==='tag'){result.push(token.txt);if((skip_match=re_skip_tags.exec(token.txt))!==null){skipped_tag=skip_match[2].toLowerCase();if(skip_match[1]){if(skipped_tag_stack.length>0){if(skipped_tag===skipped_tag_stack[skipped_tag_stack.length-1]){skipped_tag_stack.pop()}}if(skipped_tag_stack.length===0){in_pre=!1}}else{skipped_tag_stack.push(skipped_tag);in_pre=!0}}}else{t=token.txt;t=t.replace(/(rock )'n'( roll)/gi,'$1&#8217;n&#8217;$2');last_char=t.slice(-1);if(!in_pre){t=smartEscapes(t);t=smartDashes(t);t=smartEllipses(t);t=smartBackticks(t);switch(t){case "'":if(/\S/.test(prev_token_last_char)){t='&#8217;'}else{t='&#8216;'}break;case '"':if(/\S/.test(prev_token_last_char)){t='&#8221;'}else{t='&#8220;'}break;default:t=smartQuotes(t)}}prev_token_last_char=last_char;result.push(t)}});return result.join('')};var tokenize=typogr.tokenize=function(text){var tokens=[],lastIndex=0,re_tag=/([^<]*)(<[^>]*>)/gi,curr_token;while((curr_token=re_tag.exec(text))!==null){var pre_text=curr_token[1],tag_text=curr_token[2];if(pre_text){tokens.push({type:'text',txt:pre_text})}tokens.push({type:'tag',txt:tag_text});lastIndex=re_tag.lastIndex}if(re_tag.lastIndex<=text.length){if(text.slice(-1)=="."&&text.slice(-2)!='..'){tokens.push({type:'text',txt:text.slice(lastIndex,text.length-1)});tokens.push({type:'text',txt:text.slice(-1)})}else{tokens.push({type:'text',txt:text.slice(lastIndex)})}}return tokens};var smartEscapes=typogr.smartEscapes=function(text){return text.replace(/\\"/g,'&#34;').replace(/\\'/g,'&#39;').replace(/\\-/g,'&#45;').replace(/\\\./g,'&#46;').replace(/\\\\/g,'&#92;').replace(/\\`/g,'&#96;')};var smartDashes=typogr.smartDashes=function(text){return text.replace(/---/g,'&#8212;').replace(/([^<][^!]|[^!]|^)--(?!>)/g,'$1&#8211;')};var smartEllipses=typogr.smartEllipses=function(text){return text.replace(/\.\.\./g,'&#8230;').replace(/\. \. \./g,'&#8230;')};var smartBackticks=typogr.smartBackticks=function(text){return text.replace(/``/g,'&#8220;').replace(/''/g,'&#8221;')};var smartQuotes=typogr.smartQuotes=function(text){var punct_cls='[!"#\\$\\%\\\'()*+,-.\\/:;<=>?\\@\\[\\\\]\\^_`{|}~]',re_punct_str='(?=%s\\B)'.replace('%s',punct_cls),close_cls='[^\\ \\t\\r\\n\\[\\{\\(\\-]',dec_dashes='&#8211;|&#8212;',re_opening_single_quotes=re('('+'\\s|'+'&nbsp;|'+'--|'+'&[mn]dash;|'+dec_dashes+'|'+'&#x201[34];'+')'+'\''+'(?=\\w)','g'),re_closing_single_quotes=re('('+close_cls+')'+'\''+'(?!\\s | s\\b | \\d)','g'),re_closing_single_quotes2=re('('+close_cls+')'+'\''+'(?!\\s | s\\b)','g'),re_opening_double_quotes=re('('+'\\s|'+'&nbsp;|'+'--|'+'&[mn]dash;|'+dec_dashes+'|'+'&#x201[34];'+')'+'"'+'(?=\\w)','g'),re_closing_double_quotes=re('"(?=\\s)','g'),re_closing_double_quotes2=re('('+close_cls+')"','g');return text.replace(re("^'%s".replace('%s',re_punct_str),'g'),'&#8217;').replace(re('^"%s'.replace('%s',re_punct_str),'g'),'&#8221;').replace(/"'(?=\w)/g,'&#8220;&#8216;').replace(/'"(?=\w)/g,'&#8216;&#8220;').replace(/\b'(?=\d{2}s)/g,'&#8217;').replace(re_opening_single_quotes,'$1&#8216;').replace(re_closing_single_quotes,'$1&#8217;').replace(re_closing_single_quotes2,'$1&#8217;$2').replace("'",'&#8217;').replace(re_opening_double_quotes,'$1&#8220;').replace(re_closing_double_quotes,'&#8221;').replace(re_closing_double_quotes2,'$1&#8221;').replace('"','&#8220;')};var Wrapper=function(obj){this._wrapped=obj};var result=function(obj,chain){return chain?typogr(obj).chain():obj};var addToWrapper=function(name,func){Wrapper.prototype[name]=function(){return result(func.call(typogr,this._wrapped),this._chain)}};var isFunction=function(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply)};var name;for(name in typogr){if(typogr.hasOwnProperty(name)&&isFunction(typogr[name])){addToWrapper(name,typogr[name])}}Wrapper.prototype.chain=function(){this._chain=!0;return this};Wrapper.prototype.value=function(){return this._wrapped}}(this))