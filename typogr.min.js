/*!
  * typogr.js
  * Copyright(c) 2011 Eugene Kalinin
  * MIT Licensed
  */(function(e){var t=function(e){return new m(e)};t.version="0.6.0",typeof module!="undefined"&&module.exports?module.exports=t:e.typogr=t;var n=function(e,t){return new RegExp(e,t)},r=/<(\/)?(pre|code|kbd|script|math|title)[^>]*>/i,i=t.amp=function(e){var t=/(\s|&nbsp;)(&|&amp;|&\#38;)(\s|&nbsp;)/g,n=/(<[^<]*>)?([^<]*)(<\/[^<]*>)?/g;if(!e)return;return e.replace(n,function(e,n,r,i){return n=n||"",i=i||"",r=r.replace(t,'$1<span class="amp">&amp;</span>$3'),n+r+i})},s=t.ord=function(e){var t=/(\d+)(st|nd|rd|th)/g;if(!e)return;return e.replace(t,'$1<span class="ord">$2</span>')},o=t.initQuotes=function(e){var t=n("(?:(?:<(?:p|h[1-6]|li|dt|dd)[^>]*>|^)\\s*(?:<(?:a|em|span|strong|i|b)[^>]*>\\s*)*)(?:(\"|&ldquo;|&#8220;)|('|&lsquo;|&#8216;))","i");if(!e)return;return e.replace(t,function(e,t,n){var r=t?"dquo":"quo",i=t?t:n;return[e.slice(0,e.lastIndexOf(i)),'<span class="',r,'">',i,"</span>"].join("")})},u=t.widont=function(e){var t=n("((?:</?(?:a|em|span|strong|i|b)[^>]*>)|[^<>\\s])\\s+([^<>\\s]+\\s*(</(a|em|span|strong|i|b)>\\s*)*((</(p|h[1-6]|li|dt|dd)>)|$))","gi");return e.replace(t,"$1&nbsp;$2")},a=t.caps=function(e){var t=l(e),i=[],s=!1,o,u=n("((\\b[A-Z\\d]*[A-Z]\\d*[A-Z][A-Z\\d']*\\b)|(\\b[A-Z]+\\.\\s?(?:[A-Z]+\\.\\s?)+)(?:\\s|\\b|$))","g");return t.forEach(function(e){e.type==="tag"?(i.push(e.txt),o=r.exec(e.txt),o&&o[1]===undefined?s=!0:s=!1):s?i.push(e.txt):i.push(e.txt.replace(u,function(e,t,n,r){var i,s;return n?'<span class="caps">%s</span>'.replace("%s",n):(r.slice(-1)===" "?(i=r.slice(0,-1),s=" "):(i=r,s=""),'<span class="caps">%s1</span>%s2'.replace("%s1",i).replace("%s2",s))}))}),i.join("")};t.typogrify=function(e){var t=e;return e.jquery&&e.html&&(t=e.html()),t=i(t),t=u(t),t=f(t),t=a(t),t=o(t),t=s(t),t};var f=t.smartypants=function(e){var t=l(e),n=[],i=[],s="",o="",u=!1,a="",f,m;return t.forEach(function(e){if(e.type==="tag")n.push(e.txt),(o=r.exec(e.txt))!==null&&(s=o[2].toLowerCase(),o[1]?(i.length>0&&s===i[i.length-1]&&i.pop(),i.length===0&&(u=!1)):(i.push(s),u=!0));else{m=e.txt,f=m.slice(-1);if(!u){m=c(m),m=h(m),m=p(m),m=d(m);switch(m){case"'":/\S/.test(a)?m="&#8217;":m="&#8216;";break;case'"':/\S/.test(a)?m="&#8221;":m="&#8220;";break;default:m=v(m)}}a=f,n.push(m)}}),n.join("")},l=t.tokenize=function(e){var t=[],n=0,r=/([^<]*)(<[^>]*>)/gi,i;while((i=r.exec(e))!==null){var s=i[1],o=i[2];s&&t.push({type:"text",txt:s}),t.push({type:"tag",txt:o}),n=r.lastIndex}return r.lastIndex<=e.length&&t.push({type:"text",txt:e.slice(n)}),t},c=t.smartEscapes=function(e){return e.replace(/\\"/g,"&#34;").replace(/\\'/g,"&#39;").replace(/\\-/g,"&#45;").replace(/\\\./g,"&#46;").replace(/\\\\/g,"&#92;").replace(/\\`/g,"&#96;")},h=t.smartDashes=function(e){return e.replace(/---/g,"&#8212;").replace(/--/g,"&#8211;")},p=t.smartEllipses=function(e){return e.replace(/\.\.\./g,"&#8230;").replace(/\. \. \./g,"&#8230;")},d=t.smartBackticks=function(e){return e.replace(/``/g,"&#8220;").replace(/''/g,"&#8221;")},v=t.smartQuotes=function(e){var t="[!\"#\\$\\%\\'()*+,-.\\/:;<=>?\\@\\[\\\\]\\^_`{|}~]",r="(?=%s\\B)".replace("%s",t),i="[^\\ \\t\\r\\n\\[\\{\\(\\-]",s="&#8211;|&#8212;",o=n("(\\s|&nbsp;|--|&[mn]dash;|"+s+"|"+"&#x201[34];"+")"+"'"+"(?=\\w)","g"),u=n("("+i+")"+"'"+"(?!\\s | s\\b | \\d)","g"),a=n("("+i+")"+"'"+"(?!\\s | s\\b)","g"),f=n("(\\s|&nbsp;|--|&[mn]dash;|"+s+"|"+"&#x201[34];"+")"+'"'+"(?=\\w)","g"),l=n('"(?=\\s)',"g"),c=n("("+i+')"',"g");return e.replace(n("^'%s".replace("%s",r),"g"),"&#8217;").replace(n('^"%s'.replace("%s",r),"g"),"&#8221;").replace(/"'(?=\w)/g,"&#8220;&#8216;").replace(/'"(?=\w)/g,"&#8216;&#8220;").replace(/\b'(?=\d{2}s)/g,"&#8217;").replace(o,"$1&#8216;").replace(u,"$1&#8217;").replace(a,"$1&#8217;$2").replace("'","&#8216;").replace(f,"$1&#8220;").replace(l,"&#8221;").replace(c,"$1&#8221;").replace('"',"&#8220;")},m=function(e){this._wrapped=e},g=function(e,n){return n?t(e).chain():e},y=function(e,n){m.prototype[e]=function(){return g(n.call(t,this._wrapped),this._chain)}},b=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},w;for(w in t)t.hasOwnProperty(w)&&b(t[w])&&y(w,t[w]);m.prototype.chain=function(){return this._chain=!0,this},m.prototype.value=function(){return this._wrapped}})(this);